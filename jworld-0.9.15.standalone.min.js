(function(){jworld={items:{},frameRate:50,iid:null,pfx:"",pfxCss:"",tu:[],tuo:{},degrade:null,ie:false,stp:{},ctr:"transform",trEnd:"transitionend",anEnd:"animationend",e:1e-6,r2d:180/Math.PI,d2r:Math.PI/180,sortFunc:function(e,t){return t.zd-e.zd},css:function(t,n,r){var i=e.pfx;t.style[i+(i==""?n:n.charAt(0).toUpperCase()+n.substring(1))]=r},inv:function(t){if(t instanceof e.View3d){if(!e.tuo[t.cDiv.id]){e.tu.push(t);e.tuo[t.cDiv.id]=true}}else{if(!e.tuo[t.div.id]){e.tu.splice(0,0,t);e.tuo[t.div.id]=true}}},cancelUpdate:function(t){var n=e.tu,r;for(r=n.length-1;r>=0;r--){if(n[r]===t){e.tuo[t instanceof e.View3d?t.cDiv.id:t.div.id]=null;n.splice(r,1);return}}},interval:function(){var t,n=e.tu;if(n.length>0){for(t=n.length-1;t>=0;t--){n[t].update()}e.tu=[];e.tuo={}}},Sprite3d:function(){},View3d:function(t,n,r,i,s){var o=this;o._ortho=false;o.cDiv=o.div=o.wrap1=o.wrap2=null;o._perspective=0;o.sprites=[];o.createView=function(t,n,r,i,s){var o=this;if(t){if(!n)n=t.getAttribute("data-width")||t.width||t.offsetWidth||800;if(!r)r=t.getAttribute("data-height")||t.height||t.offsetHeight||600;if(!i)i=Number(t.getAttribute("data-fov"))||55;o._width=n;o._height=r;o.cDiv=t;t.style.width=n+"px";t.style.height=r+"px";t.style.overflow="hidden";t.style.position="relative";o.div=document.createElement("div");o.wrap1=document.createElement("div");o.wrap2=document.createElement("div");o.wrap1.appendChild(o.wrap2);o.wrap2.appendChild(o.div);if(!e.ie&&e.support){e.css(o.wrap2,"transformStyle","preserve-3d");e.css(o.div,"transformStyle","preserve-3d")}o.wrap1.style.position="absolute";e.setupDataTransform(t,o);o.fov(i);if(!s){o.addElements(t)}o.updateSize();t.appendChild(o.wrap1)}};o.addElements=function(e){var t,n;if(typeof e=="string"){t=this.div.childNodes;var r=t.length;$(this.div).append(e);var i=t.length;for(n=r;n<i;n++){var s=this.newSprite(t.item(n))}}else{if(typeof e.length!="undefined"){t=e;for(n=t.length-1;n>=0;n--){this.newSprite(t[n])}}else{var o;t=e.childNodes;for(n=t.length-1;n>=0;n--){o=t.item(n);if(o.nodeType==1&&o!=this.wrap1){this.newSprite(o)}}}}};o.add=function(e){var t=this.newSprite(e);return t};o.newSprite=function(t){var n=new e.Sprite3d;n.view=this;n.setDiv(t);this.sprites.push(n);e.items[t.id]=n;e.setupDataTransform(t,n);n.updateSize();n.update();e.cancelUpdate(n);this.div.appendChild(t);return n};o.removeElements=function(e){var t,n,r;if(typeof e.length!="undefined"){t=e;for(r=t.length-1;r>=0;r--){this.remove(t[r])}}else{t=e.childNodes;for(r=t.length-1;r>=0;r--){n=t.item(r);if(n.nodeType==1)this.remove(n)}}};o.remove=function(t){if(t.nodeType==1){var n,r=this.sprites;for(n=0;n<r.length;n++){if(r[n].div===t){r.splice(n,1);this.div.removeChild(t);e.items[t.id]=null;break}}}};o.getwidth=function(){return this._width};o.width=function(e){this._width=e;this.invs=true};o.getheight=function(){return this._height};o.height=function(e){this._height=e;this.invs=true};o.ortho=function(e){this._ortho=e;this.fov(this.getfov())};o.getortho=function(){return this._ortho};o._fov=0;o.getfov=function(){return this._fov*e.r2d};o.fov=function(t){this._fov=t*e.d2r;this.perspective(this.getFocalLength());e.inv(this)};o.setFocalLength=function(e){this._fov=Math.atan2(this._height/2,e)*2};o.getFocalLength=function(){var e=this._fov/2;return this._height/2*(Math.cos(e)/Math.sin(e))};o.perspective=function(t){var n=this;n._perspective=t;n.setFocalLength(t);if(e.support&&!e.ie){if(n._ortho){e.css(n.wrap2,"perspective","none")}else{e.css(n.wrap2,"perspective",t+(e.pfx=="Webkit"?"":"px"))}e.inv(n)}};o.update=function(){var t=this;if(e.support){if(!e.ie){var n=-(t._x*t.ma+t._y*t.mb+t._z*t.mc),r=t._x*t.me+t._y*t.mf+t._z*t.mg,i=t._x*t.mi+t._y*t.mj+t._z*t.mk+this._perspective,s=e.e;if(n<s&&n>-s)n=0;if(r<s&&r>-s)r=0;if(i<s&&i>-s)i=0;t.div.style[e.ctr]="matrix3d("+t.ma+","+ -t.me+","+ -t.mi+",0,"+t.mb+","+ -t.mf+","+ -t.mj+",0,"+t.mc+","+ -t.mg+","+ -t.mk+",0,"+n+","+r+","+i+",1)"}else{var o,u=t.sprites;for(o=0;o<u.length;o++){u[o].update();e.cancelUpdate(t.sprites[o])}u.sort(e.sortFunc);for(o=0;o<u.length;o++){u[o].div.style.zIndex=t.zd+o}}}else{if(e.degrade){e.degrade.updateView(t)}}};o.updateSize=function(){var t=this,n=t.wrap1.style;t.invs=false;n.left=Math.floor(t._width/2)+"px";n.top=Math.floor(t._height/2)+"px";n=t.cDiv.style;n.width=t._width+"px";n.height=t._height+"px";t.fov(t.getfov());if(!e.support&&e.degrade){e.degrade.updateSizeView(t)}};o.createView(t,n,r,i,s)},setupDataTransform:function(t,n){var r,i,s;for(var o in t.attributes){r=t.attributes[o].name;i=t.getAttribute(r);s=Number(i);switch(r){case"data-x":case"data-position-x":n.x(s);break;case"data-y":case"data-position-y":n.y(s);break;case"data-z":case"data-position-z":n.z(s);break;case"data-rx":case"data-rotate-x":n.rotateX(s);break;case"data-ry":case"data-rotate-y":n.rotateY(s);break;case"data-rz":case"data-rotate-z":n.rotateZ(s);break;case"data-sx":case"data-scale-x":n.scaleX(s);break;case"data-sy":case"data-scale-y":n.scaleY(s);break;case"data-sz":case"data-scale-z":n.scaleZ(s);break;case"data-px":case"data-pivot-x":n.pivotX(i);break;case"data-py":case"data-pivot-y":n.pivotY(i);break;case"data-pz":case"data-pivot-z":n.pivotZ(i);break;case"data-mx":case"data-move-x":n.moveX(s);break;case"data-my":case"data-move-y":n.moveY(s);break;case"data-mz":case"data-move-z":n.moveZ(s);break;case"data-lrx":case"data-local-rotate-x":n.localRotateX(s);break;case"data-lry":case"data-local-rotate-y":n.localRotateY(s);break;case"data-lrz":case"data-local-rotate-z":n.localRotateZ(s);break;case"data-double-sided":if(!(n instanceof e.View3d))n.doubleSided(Boolean(i));break;case"data-ortho":case"data-orthographic":if(n instanceof e.View3d)n.ortho(Boolean(i));break;default:break}}}};var e=jworld;e.Sprite3d.prototype={_x:0,_y:0,_z:0,_scaleX:1,_scaleY:1,_scaleZ:1,rx:0,ry:0,rz:0,_pivotX:"",_pivotY:"",_pivotZ:"",regX:0,regY:0,regZ:0,zd:0,_width:0,_height:0,invs:true,ma:1,mb:0,mc:0,me:0,mf:1,mg:0,mi:0,mj:0,mk:1,id:function(){var e=this;e.ma=e.mf=e.mk=1;e.mb=e.mc=e.me=e.mg=e.mi=e.mj=0},clearCss:function(){if(e.support){e.css(this.div,"transformStyle","");e.css(this.div,"transform","");e.css(this.div,"transformOrigin","")}},getx:function(){return this._x},x:function(t){this._x=t;e.inv(this)},gety:function(){return this._y},y:function(t){this._y=t;e.inv(this)},getz:function(){return this._z},z:function(t){this._z=t;e.inv(this)},offsetX:function(t){this._x+=t;e.inv(this)},offsetY:function(t){this._y+=t;e.inv(this)},offsetZ:function(t){this._z+=t;e.inv(this)},move:function(t,n){this._x+=t.x*n;this._y+=t.y*n;this._z+=t.z*n;e.inv(this)},moveX:function(e){this.move(this.getXAxis(),e)},moveY:function(e){this.move(this.getYAxis(),e)},moveZ:function(e){this.move(this.getZAxis(),e)},getrotateX:function(){return this.rx*e.r2d},rotateX:function(t){this.rx=t*e.d2r;this.initAxis()},getrotateY:function(){return this.ry*e.r2d},rotateY:function(t){this.ry=t*e.d2r;this.initAxis()},getrotateZ:function(){return this.rz*e.r2d},rotateZ:function(t){this.rz=t*e.d2r;this.initAxis()},offsetRotateX:function(t){this.rx+=t*e.d2r;this.initAxis()},offsetRotateY:function(t){this.ry+=t*e.d2r;this.initAxis()},offsetRotateZ:function(t){this.rz+=t*e.d2r;this.initAxis()},rotate:function(t,n){var r=e.e;if(Math.abs(n)<r)return;n=n*e.d2r;var i=t.x,s=t.y,o=t.z,u=this,a=Math.sqrt(i*i+s*s+o*o);i/=a;s/=a;o/=a;var f=Math.sin(n),l=Math.cos(n),c=1-l,h=f*i,p=f*s,d=f*o,v=s*i*c,m=s*o*c,g=o*i*c,y=i*i*c+l,b=v+d,w=g-p,E=v-d,S=s*s*c+l,x=m+h,T=g+p,N=m-h,C=o*o*c+l,k=u.ma,L=u.mb,A=u.mc,O=u.me,M=u.mf,_=u.mg,D=u.mi,P=u.mj,H=u.mk;u.ma=k*y+L*E+A*T;u.mb=k*b+L*S+A*N;u.mc=k*w+L*x+A*C;u.me=O*y+M*E+_*T;u.mf=O*b+M*S+_*N;u.mg=O*w+M*x+_*C;u.mi=D*y+P*E+H*T;u.mj=D*b+P*S+H*N;u.mk=D*w+P*x+H*C;if(u.ma<r&&u.ma>-r)u.ma=0;if(u.mb<r&&u.mb>-r)u.mb=0;if(u.mc<r&&u.mc>-r)u.mc=0;if(u.me<r&&u.me>-r)u.me=0;if(u.mf<r&&u.mf>-r)u.mf=0;if(u.mg<r&&u.mg>-r)u.mg=0;if(u.mi<r&&u.mi>-r)u.mi=0;if(u.mj<r&&u.mj>-r)u.mj=0;if(u.mk<r&&u.mk>-r)u.mk=0;e.inv(u);u.updateRotation(u)},getpivotX:function(){return this._pivotX},pivotX:function(e){if(!isNaN(Number(e)))this._pivotX=Number(e);else this._pivotX=e;this.invs=true},getpivotY:function(){return this._pivotY},pivotY:function(e){if(!isNaN(Number(e)))this._pivotY=Number(e);else this._pivotY=e;this.invs=true},getpivotZ:function(){return this._pivotZ},pivotZ:function(e){if(!isNaN(Number(e)))this._pivotZ=Number(e);else this._pivotZ=e;this.invs=true},localRotateX:function(e){this.rotate(this.getXAxis(),e)},localRotateY:function(e){this.rotate(this.getYAxis(),e)},localRotateZ:function(e){this.rotate(this.getZAxis(),e)},updateRotation:function(e){var t=this,n=Math.asin(e.mj);t.ry=0;t.rx=-n;if(n<Math.PI/2){if(n>-Math.PI/2){t.rz=-Math.atan2(-e.mb,e.mf);t.ry=-Math.atan2(-e.mi,e.mk)}else{t.rz=Math.atan2(e.mb,e.ma)}}else{t.rz=-Math.atan2(e.mc,e.ma)}},initAxis:function(){var t=this,n=-t.rx,r=t.ry,i=-t.rz,s=Math.cos(n),o=Math.sin(n),u=Math.cos(r),a=Math.sin(r),f=Math.cos(i),l=Math.sin(i),c=e.e;t.ma=f*u-l*-o*a;t.mb=-l*s;t.mc=f*-a-l*-o*u;t.me=l*u+f*-o*a;t.mf=f*s;t.mg=l*-a+f*-o*u;t.mi=s*a;t.mj=o;t.mk=s*u;if(t.ma<c&&t.ma>-c)t.ma=0;if(t.mb<c&&t.mb>-c)t.mb=0;if(t.mc<c&&t.mc>-c)t.mc=0;if(t.me<c&&t.me>-c)t.me=0;if(t.mf<c&&t.mf>-c)t.mf=0;if(t.mg<c&&t.mg>-c)t.mg=0;if(t.mi<c&&t.mi>-c)t.mi=0;if(t.mj<c&&t.mj>-c)t.mj=0;if(t.mk<c&&t.mk>-c)t.mk=0;e.inv(this)},getXAxis:function(){return{x:this.ma,y:this.mb,z:this.mc}},getYAxis:function(){return{x:this.me,y:this.mf,z:this.mg}},getZAxis:function(){return{x:this.mi,y:this.mj,z:this.mk}},getscaleX:function(){return this._scaleX},scaleX:function(t){this._scaleX=t;e.inv(this)},getscaleY:function(){return this._scaleY},scaleY:function(t){this._scaleY=t;e.inv(this)},getscaleZ:function(){return this._scaleZ},scaleZ:function(t){this._scaleZ=t;e.inv(this)},reset:function(){var e=this;e.id();e._x=e._y=e._z=e.rx=e.ry=e.rz=0;e._scaleX=e._scaleY=e._scaleZ=1},getdoubleSided:function(){return this._ds},doubleSided:function(t){this._ds=t;e.css(this.div,"backfaceVisibility",this._ds==true?"visible":"hidden");if(!e.support&&e.degrade){e.inv(this)}},updateSize:function(){var t=this,n=t.div,r="",i,s;t.invs=false;if(n.hasAttribute("data-width")){i=Number(n.getAttribute("data-width"))}else{i=n.width>0?n.width:n.offsetWidth}if(n.hasAttribute("data-height")){s=Number(n.getAttribute("data-height"))}else{s=n.height>0?n.height:n.offsetHeight}t._width=i;t._height=s;var o=Math.floor(i*.5),u=Math.floor(s*.5);if(typeof t._pivotX=="number"){t.regX=t._pivotX-o;r=t._pivotX+"px "}else if(t._pivotX=="left"){t.regX=-o;r="0px "}else if(t._pivotX=="right"){t.regX=o;r=i+"px "}else{t.regX=0;r=o+"px "}if(typeof t._pivotY=="number"){t.regY=t._pivotY-u;r+=t._pivotY+"px "}else if(t._pivotY=="top"){t.regY=-u;r+="0px "}else if(t._pivotY=="bottom"){t.regY=u;r+=s+"px "}else{t.regY=0;r+=u+"px "}if(typeof t._pivotZ=="number"){if(e.pfx=="Moz"){t.regZ=t._pivotZ}else{t.regZ=0}r+=t._pivotZ+"px"}else{t.regZ=0;r+="0px"}n.style.left=-o+"px";n.style.top=-u+"px";if(e.support){e.css(n,"transformOrigin",r)}else{if(e.degrade){e.degrade.updateSizeSprite(this)}}},update:function(){if(e.support){var t=this;if(!e.ie){var n=e.r2d;t.div.style[e.ctr]="translate3d("+(t._x-t.regX)+"px,"+(t._y-t.regY)+"px,"+(t._z-t.regZ)+"px) rotateY("+t.ry*n+"deg) rotateX("+t.rx*n+"deg) rotateZ("+t.rz*n+"deg) scale3d("+t._scaleX+","+ -t._scaleY+","+ -t._scaleZ+")"}else{var r=t.view,i=r.ma,s=-r.me,o=-r.mi,u=r.mb,a=-r.mf,f=-r.mj,l=r.mc,c=-r.mg,h=-r.mk,p=-(r._x*r.ma+r._y*r.mb+r._z*r.mc),d=-(r._x*-r.me+r._y*-r.mf+r._z*-r.mg),v=-(r._x*-r.mi+r._y*-r.mj+r._z*-r.mk),m=(t.ma*i+t.mb*u+t.mc*l)*t._scaleX,g=(t.ma*s+t.mb*a+t.mc*c)*t._scaleX,y=(t.ma*o+t.mb*f+t.mc*h)*t._scaleX,b=(-t.me*i+ -t.mf*u+ -t.mg*l)*t._scaleY,w=(-t.me*s+ -t.mf*a+ -t.mg*c)*t._scaleY,E=(-t.me*o+ -t.mf*f+ -t.mg*h)*t._scaleY,S=(t.mi*i+t.mj*u+t.mk*l)*-t._scaleZ,x=(t.mi*s+t.mj*a+t.mk*c)*-t._scaleZ,T=(t.mi*o+t.mj*f+t.mk*h)*-t._scaleZ,N=t._x-t.regX,C=t._y+t.regY,k=t._z-t.regZ,L=N*i+C*u+k*l+p,A=N*s+C*a+k*c+d,O=N*o+C*f+k*h+v;t.zd=-O;t.div.style[e.ctr]="perspective("+t.view._perspective+"px) matrix3d("+m+","+g+","+y+",0,"+b+","+w+","+E+",0,"+S+","+x+","+T+",0,"+L+","+A+","+(O+t.view._perspective)+",1)"}}else{if(e.degrade){e.degrade.updateSprite(this)}}},setDiv:function(t){this.div=t;t.style.position="absolute";e.css(t,"transformStyle","preserve-3d")}};e.View3d.prototype=new e.Sprite3d;e.startInterval=function(){if(!e.running){e.running=true;e.iid=setInterval(e.interval,1e3/e.frameRate)}};e.support=function(){var t,n,r=document.createElement("div"),i=["Webkit","Moz","O","ms"];for(t=0;t<i.length;t++){n=i[t];if(n+"Perspective"in r.style){e.pfx=n;e.pfxCss="-"+n.toLowerCase()+"-";e.ctr=n+"Transform";if(n=="ms"){e.ie=true}else if(n=="Webkit"){e.trEnd="webkitTransitionEnd";e.anEnd="webkitAnimationEnd"}return true}}return false}()})()