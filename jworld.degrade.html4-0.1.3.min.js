(function(e){if(e.fn.world){var t=e.fn.world.core;t.degradeHtml4={updateSprite:function(e){var n={},r={},i={},s=e._width,o=e._height;t.stp.projectPoint(e.view,e,0,0,0,n,true);var u="block";if(n.culled){e.div.style.display="none";return}else{e.div.style.left=Math.floor(n.sx)+"px";e.div.style.top=Math.floor(n.sy)+"px"}e.zd=n.wz;if(typeof e.noDepthScale==="undefined"){t.stp.projectPoint(e.view,e,0,-o/2,0,r,true);t.stp.projectPoint(e.view,e,s/2,0,0,i,true);var a=i.sx-n.sx;var f=i.sy-n.sy;var l=Math.sqrt(a*a+f*f);var c=r.sx-n.sx;var h=r.sy-n.sy;var p=Math.sqrt(c*c+h*h);if(a>0){e.div.style.width=Math.floor(l*2)+"px";e.div.style.left=Math.floor(n.sx)-l+"px"}else{if(e._ds==true){e.div.style.width=Math.floor(-l*2)+"px";e.div.style.left=Math.floor(n.sx)+l+"px"}else{u="none"}}if(h>0){e.div.style.height=Math.floor(p*2)+"px";e.div.style.top=Math.floor(n.sy)-p+"px"}else{if(e._ds==true){e.div.style.height=Math.floor(-p*2)+"px";e.div.style.top=Math.floor(n.sy)+p+"px"}else{u="none"}}}e.div.style.display=u},updateSizeSprite:function(e){},updateSizeView:function(e){var n=987654;var r=.01;if(!e._ortho){var i=e._height/e._width;var s=Math.cos(e._fov/2)/Math.sin(e._fov/2);var o=i*s;var u=n/(n-r);t.stp.html4_a=o;t.stp.html4_f=s;t.stp.html4_k=u;t.stp.html4_o=-u*r}},updateView:function(e){var n=t.stp.html4_cgv;n.a=e.ma*t.stp.html4_a;n.b=e.me*t.stp.html4_f;n.c=e.mi*t.stp.html4_k;n.e=e.mb*t.stp.html4_a;n.f=e.mf*t.stp.html4_f;n.g=e.mj*t.stp.html4_k;n.i=e.mc*t.stp.html4_a;n.j=e.mg*t.stp.html4_f;n.k=e.mk*t.stp.html4_k;var r=e._x;var i=e._y;var s=e._z;t.stp.html4_x=-(r*e.ma+i*e.mb+s*e.mc)*t.stp.html4_a;t.stp.html4_y=-(r*e.me+i*e.mf+s*e.mg)*t.stp.html4_f;t.stp.html4_z=-(r*e.mi+i*e.mj+s*e.mk)*t.stp.html4_k+t.stp.html4_o;for(var o=0;o<e.sprites.length;o++){e.sprites[o].update();t.cancelUpdate(e.sprites[o])}e.sprites.sort(t.sortFunc);for(o=0;o<e.sprites.length;o++){e.sprites[o].div.style.zIndex=e.zd+o}}};t.stp.projectPoint=function(e,n,r,i,s,o,u){if(n!=null){var a=n.ma*r+n.me*i+n.mi*s+n._x;var f=n.mb*r+n.mf*i+n.mj*s+n._y;var l=n.mc*r+n.mg*i+n.mk*s+n._z;r=a;i=f;s=l}var c=t.stp.html4_cgv;o.wx=c.a*r+c.e*i+c.i*s+t.stp.html4_x;o.wy=c.b*r+c.f*i+c.j*s+t.stp.html4_y;o.wz=c.c*r+c.g*i+c.k*s+t.stp.html4_z+.01;var h=e._height/2;var p=e._width/2;if(!e._ortho){if(u){if(o.wz<.01||o.wy<-o.wz||o.wy>o.wz||o.wx<-o.wz||o.wx>o.wz){o.culled=true}}else{o.culled=false}if(o.wz>0){o.sy=-o.wy/o.wz*h;o.sx=o.wx/o.wz*p}else{o.sy=-o.wy*h;o.sx=o.wx*p}}};t.stp.html4_cgv={a:1,b:0,c:0,e:0,f:1,g:0,i:0,j:0,k:1};t.stp.html4_x=0;t.stp.html4_y=0;t.stp.html4_z=0;t.stp.html4_a=0;t.stp.html4_f=0;t.stp.html4_k=0;t.stp.html4_o=0;t.degrade=t.degradeHtml4}})(jQuery)