(function(e){e.fn.world=function(n,r,i){var s=this,o=s.length,u=t.items,a,f,l,c;if(typeof n!="string"){if(r!=undefined)i=r;r=n;n="set"}if(n=="set"){for(l=0;l<o;l++){c=s[l];f=u[c.id];if(!f){if(t.iid==null)t.iid=setInterval(t.interval,1e3/t.frameRate);f=new t.View3d(c,0,0,0,r?r.noSetup:false);u[c.id]=f}for(var h in r){a=typeof f[h];if(a=="function"){f[h](r[h])}else if(a!="undefined"){f[h]=r[h]}}if(f.invs)f.updateSize()}}else if(n=="get"){f=u[s[0].id];if(f){var p=typeof i=="object"?i:r;for(var h in r){a=typeof f["get"+h];if(a!="undefined"){if(a=="function"){p[h]=f["get"+h]()}else{p[h]=f["get"+h]}}else{if(a=="function"){p[h]=f[h]()}else{p[h]=f[h]}}}return p}else{return typeof i=="object"?i:null}}else if(n=="page"){for(l=0;l<o;l++){c=s[l];if(r.transition)t.css(c,"transition",r.transition);if(typeof r.transitionEnd=="function")f.div.addEventListener(t.trEnd,r.transitionEnd);t.css(c,"transformOrigin",r.transformOrigin||"50% 50% 0px");t.css(c,"perspectiveOrigin",r.perspectiveOrigin||"0px 0px");t.css(c,"transformStyle",r.transformStyle||"preserve-3d");c.style[t.ctr]="perspective("+(r.perspective||550)+(t.pfx=="Webkit"?"":"px")+") translate3d("+(r.x||0)+"px,"+(r.y||0)+"px,"+(r.z||0)+"px) rotateY("+(r.rotateY||0)+"deg) rotateX("+(r.rotateX||0)+"deg) rotateZ("+(r.rotateZ||0)+"deg) scale3d("+(r.scaleX||1)+","+(r.scaleY||1)+","+(r.scaleZ||1)+")"}}else if(n=="move"||n=="rotate"){for(l=0;l<o;l++){f=u[s[l].id];if(f)f[n](r,i)}}else if(n=="reset"||n=="update"||n=="updateSize"){for(l=0;l<o;l++){f=u[s[l].id];if(f)f[n]()}}else if(n=="matrixTransition"){if(typeof r=="string"){for(l=0;l<o;l++){f=u[s[l].id];if(f){t.css(f.div,"transition",t.pfxCss+"transform "+r);if(typeof i=="function"){f.div.addEventListener(t.trEnd,i)}}}}}else if(n=="css"){if(typeof r=="string"&&typeof i=="string"){for(l=0;l<o;l++){f=u[s[l].id];if(f)t.css(f.div,r,i)}}}else if(n=="animation"){for(l=0;l<o;l++){f=u[s[l].id];if(f){t.css(f.div,"animation",r);if(typeof i=="function")f.div.addEventListener(t.anEnd,i)}}}else if(n=="matrixChannel"){var d='<style type="text/css">\n@'+t.pfxCss+"keyframes "+r+" {\n";var v,h,m=2;if(arguments.length>2){f=u[typeof arguments[2]=="string"?arguments[2]:arguments[2].id]||null;if(f)m++}for(l=m;l<arguments.length;l++){v=arguments[l];if(typeof v=="object"){d+=v.frame+" { ";for(h in v){if(h=="frame"||h=="x"||h=="y"||h=="z"||h=="rotateX"||h=="rotateY"||h=="rotateZ"||h=="scaleX"||h=="scaleY"||h=="scaleZ")continue;d+=h+":"+v[h]+"; "}if(f){d+=t.pfxCss+"transform: translate3d("+(typeof v.x=="number"?v.x:f.getx())+"px,"+(typeof v.y=="number"?v.y:f.gety())+"px,"+(typeof v.z=="number"?v.z:f.getz())+"px) rotateY("+(typeof v.rotateY=="number"?v.rotateY:f.getrotateY())+"deg) rotateX("+(typeof v.rotateX=="number"?v.rotateX:f.getrotateX())+"deg) rotateZ("+(typeof v.rotateZ=="number"?v.rotateZ:f.getrotateZ())+"deg) scale3d("+(typeof v.scaleX=="number"?v.scaleX:f.getscaleX())+","+(typeof v.scaleY=="number"?-v.scaleY:-f.getscaleY())+","+(typeof v.scaleZ=="number"?-v.scaleZ:-f.getscaleZ())+"); "}else{d+=t.pfxCss+"transform: translate3d("+(v.x||0)+"px,"+(v.y||0)+"px,"+(v.z||0)+"px) rotateY("+(v.rotateY||0)+"deg) rotateX("+(v.rotateX||0)+"deg) rotateZ("+(v.rotateZ||0)+"deg) scale3d("+(v.scaleX||1)+","+(v.scaleY||1)*-1+","+(v.scaleZ||1)*-1+"); "}}d+=" } \n"}d+="} \n</style>";e("head").append(d)}else if(n=="object3d"){return u[s[0].id]}else if(n=="container"){return u[s[0].id].div}else if(n=="clearAll"){for(var h in t.items){t.items[h].clearCss()}t.items={};t.tu=[];t.tuo={}}else if(n=="browserPrefix"){return t.pfx}else if(n=="cssPrefix"){return t.pfxCss}else if(n=="support"){return t.support}else if(n=="frameRate"){if(r==undefined)return t.frameRate;t.frameRate=r;if(t.iid!=null){clearInterval(t.iid);t.iid=setInterval(t.interval,1e3/t.frameRate)}}else{if(r==undefined){f=u[s[0].id];var p=null;if(f){a=typeof f["get"+n];if(a!="undefined"){if(a=="function"){p=f["get"+n]()}else{p=f["get"+n]}}else{a=typeof f[n];if(a!="undefined"){if(a=="function"){p=f[n]()}else{p=f[n]}}}}return p}else{for(l=0;l<o;l++){f=u[s[l].id];if(f){a=typeof f[n];if(a=="function"){f[n](r)}else{f[n]=r}if(f.invs)f.updateSize()}}}}return this};e.fn.world.core={items:{},frameRate:50,iid:null,pfx:"",pfxCss:"",tu:[],tuo:{},degrade:null,ie:false,stp:{},ctr:"transform",trEnd:"transitionend",anEnd:"animationend",e:1e-6,r2d:180/Math.PI,d2r:Math.PI/180,sortFunc:function(e,t){return t.zd-e.zd},css:function(e,n,r){var i=t.pfx;e.style[i+(i==""?n:n.charAt(0).toUpperCase()+n.substring(1))]=r},inv:function(e){if(e instanceof t.View3d){if(!t.tuo[e.cDiv.id]){t.tu.push(e);t.tuo[e.cDiv.id]=true}}else{if(!t.tuo[e.div.id]){t.tu.splice(0,0,e);t.tuo[e.div.id]=true}}},cancelUpdate:function(e){var n=t.tu,r;for(r=n.length-1;r>=0;r--){if(n[r]===e){t.tuo[e instanceof t.View3d?e.cDiv.id:e.div.id]=null;n.splice(r,1);return}}},interval:function(){var e,n=t.tu;if(n.length>0){for(e=n.length-1;e>=0;e--){n[e].update()}t.tu=[];t.tuo={}}},Sprite3d:function(){},View3d:function(n,r,i,s,o){var u=this;u._ortho=false;u.cDiv=u.div=u.wrap1=u.wrap2=null;u._perspective=0;u.sprites=[];u.createView=function(e,n,r,i,s){var o=this;if(e){if(!n)n=e.getAttribute("data-width")||e.width||e.offsetWidth||800;if(!r)r=e.getAttribute("data-height")||e.height||e.offsetHeight||600;if(!i)i=Number(e.getAttribute("data-fov"))||55;o._width=n;o._height=r;o.cDiv=e;e.style.width=n+"px";e.style.height=r+"px";e.style.overflow="hidden";e.style.position="relative";o.div=document.createElement("div");o.wrap1=document.createElement("div");o.wrap2=document.createElement("div");o.wrap1.appendChild(o.wrap2);o.wrap2.appendChild(o.div);if(!t.ie&&t.support){t.css(o.wrap2,"transformStyle","preserve-3d");t.css(o.div,"transformStyle","preserve-3d")}o.wrap1.style.position="absolute";t.setupDataTransform(e,o);o.fov(i);if(!s){o.addElements(e)}e.appendChild(o.wrap1)}};u.addElements=function(t){var n,r;if(typeof t=="string"){n=this.div.childNodes;var i=n.length;e(this.div).append(t);var s=n.length;for(r=i;r<s;r++){var o=this.newSprite(n.item(r))}}else{if(typeof t.length!="undefined"){n=t;for(r=n.length-1;r>=0;r--){this.newSprite(n[r])}}else{var u;n=t.childNodes;for(r=n.length-1;r>=0;r--){u=n.item(r);if(u.nodeType==1&&u!=this.wrap1){this.newSprite(u)}}}}};u.add=function(e){this.newSprite(e)};u.newSprite=function(e){var n=new t.Sprite3d;n.view=this;n.setDiv(e);this.sprites.push(n);t.items[e.id]=n;t.setupDataTransform(e,n);n.updateSize();n.update();t.cancelUpdate(n);this.div.appendChild(e);return n};u.removeElements=function(e){var t,n,r;if(typeof e.length!="undefined"){t=e;for(r=t.length-1;r>=0;r--){this.remove(t[r])}}else{t=e.childNodes;for(r=t.length-1;r>=0;r--){n=t.item(r);if(n.nodeType==1)this.remove(n)}}};u.remove=function(e){if(e.nodeType==1){var n,r=this.sprites;for(n=0;n<r.length;n++){if(r[n].div===e){r.splice(n,1);this.div.removeChild(e);t.items[e.id]=null;break}}}};u.getwidth=function(){return this._width};u.width=function(e){this._width=e;this.invs=true};u.getheight=function(){return this._height};u.height=function(e){this._height=e;this.invs=true};u.ortho=function(e){this._ortho=e;this.fov(this.getfov())};u.getortho=function(){return this._ortho};u._fov=0;u.getfov=function(){return this._fov*t.r2d};u.fov=function(e){this._fov=e*t.d2r;this.perspective(this.getFocalLength());t.inv(this)};u.setFocalLength=function(e){this._fov=Math.atan2(this._height/2,e)*2};u.getFocalLength=function(){var e=this._fov/2;return this._height/2*(Math.cos(e)/Math.sin(e))};u.perspective=function(e){var n=this;n._perspective=e;n.setFocalLength(e);if(t.support&&!t.ie){if(n._ortho){t.css(n.wrap2,"perspective","none")}else{t.css(n.wrap2,"perspective",e+(t.pfx=="Webkit"?"":"px"))}t.inv(n)}};u.update=function(){var e=this;if(t.support){if(!t.ie){var n=-(e._x*e.ma+e._y*e.mb+e._z*e.mc),r=e._x*e.me+e._y*e.mf+e._z*e.mg,i=e._x*e.mi+e._y*e.mj+e._z*e.mk+this._perspective,s=t.e;if(n<s&&n>-s)n=0;if(r<s&&r>-s)r=0;if(i<s&&i>-s)i=0;e.div.style[t.ctr]="matrix3d("+e.ma+","+ -e.me+","+ -e.mi+",0,"+e.mb+","+ -e.mf+","+ -e.mj+",0,"+e.mc+","+ -e.mg+","+ -e.mk+",0,"+n+","+r+","+i+",1)"}else{var o,u=e.sprites;for(o=0;o<u.length;o++){u[o].update();t.cancelUpdate(e.sprites[o])}u.sort(t.sortFunc);for(o=0;o<u.length;o++){u[o].div.style.zIndex=e.zd+o}}}else{if(t.degrade){t.degrade.updateView(e)}}};u.updateSize=function(){var e=this,n=e.wrap1.style;e.invs=false;n.left=Math.floor(e._width/2)+"px";n.top=Math.floor(e._height/2)+"px";n=e.cDiv.style;n.width=e._width+"px";n.height=e._height+"px";e.fov(e.getfov());if(!t.support&&t.degrade){t.degrade.updateSizeView(e)}};u.createView(n,r,i,s,o)},setupDataTransform:function(e,n){var r,i,s;for(var o in e.attributes){r=e.attributes[o].name;i=e.getAttribute(r);s=Number(i);switch(r){case"data-x":case"data-position-x":n.x(s);break;case"data-y":case"data-position-y":n.y(s);break;case"data-z":case"data-position-z":n.z(s);break;case"data-rx":case"data-rotate-x":n.rotateX(s);break;case"data-ry":case"data-rotate-y":n.rotateY(s);break;case"data-rz":case"data-rotate-z":n.rotateZ(s);break;case"data-sx":case"data-scale-x":n.scaleX(s);break;case"data-sy":case"data-scale-y":n.scaleY(s);break;case"data-sz":case"data-scale-z":n.scaleZ(s);break;case"data-px":case"data-pivot-x":n.pivotX(i);break;case"data-py":case"data-pivot-y":n.pivotY(i);break;case"data-pz":case"data-pivot-z":n.pivotZ(i);break;case"data-mx":case"data-move-x":n.moveX(s);break;case"data-my":case"data-move-y":n.moveY(s);break;case"data-mz":case"data-move-z":n.moveZ(s);break;case"data-lrx":case"data-local-rotate-x":n.localRotateX(s);break;case"data-lry":case"data-local-rotate-y":n.localRotateY(s);break;case"data-lrz":case"data-local-rotate-z":n.localRotateZ(s);break;case"data-double-sided":if(!(n instanceof t.View3d))n.doubleSided(Boolean(i));break;case"data-ortho":case"data-orthographic":if(n instanceof t.View3d)n.ortho(Boolean(i));break;default:break}}}};var t=e.fn.world.core;t.Sprite3d.prototype={_x:0,_y:0,_z:0,_scaleX:1,_scaleY:1,_scaleZ:1,rx:0,ry:0,rz:0,_pivotX:"",_pivotY:"",_pivotZ:"",regX:0,regY:0,regZ:0,zd:0,_width:0,_height:0,invs:true,ma:1,mb:0,mc:0,me:0,mf:1,mg:0,mi:0,mj:0,mk:1,id:function(){var e=this;e.ma=e.mf=e.mk=1;e.mb=e.mc=e.me=e.mg=e.mi=e.mj=0},clearCss:function(){if(t.support){t.css(this.div,"transformStyle","");t.css(this.div,"transform","");t.css(this.div,"transformOrigin","")}},getx:function(){return this._x},x:function(e){this._x=e;t.inv(this)},gety:function(){return this._y},y:function(e){this._y=e;t.inv(this)},getz:function(){return this._z},z:function(e){this._z=e;t.inv(this)},offsetX:function(e){this._x+=e;t.inv(this)},offsetY:function(e){this._y+=e;t.inv(this)},offsetZ:function(e){this._z+=e;t.inv(this)},move:function(e,n){this._x+=e.x*n;this._y+=e.y*n;this._z+=e.z*n;t.inv(this)},moveX:function(e){this.move(this.getXAxis(),e)},moveY:function(e){this.move(this.getYAxis(),e)},moveZ:function(e){this.move(this.getZAxis(),e)},getrotateX:function(){return this.rx*t.r2d},rotateX:function(e){this.rx=e*t.d2r;this.initAxis()},getrotateY:function(){return this.ry*t.r2d},rotateY:function(e){this.ry=e*t.d2r;this.initAxis()},getrotateZ:function(){return this.rz*t.r2d},rotateZ:function(e){this.rz=e*t.d2r;this.initAxis()},offsetRotateX:function(e){this.rx+=e*t.d2r;this.initAxis()},offsetRotateY:function(e){this.ry+=e*t.d2r;this.initAxis()},offsetRotateZ:function(e){this.rz+=e*t.d2r;this.initAxis()},rotate:function(e,n){var r=t.e;if(Math.abs(n)<r)return;n=n*t.d2r;var i=e.x,s=e.y,o=e.z,u=this,a=Math.sqrt(i*i+s*s+o*o);i/=a;s/=a;o/=a;var f=Math.sin(n),l=Math.cos(n),c=1-l,h=f*i,p=f*s,d=f*o,v=s*i*c,m=s*o*c,g=o*i*c,y=i*i*c+l,b=v+d,w=g-p,E=v-d,S=s*s*c+l,x=m+h,T=g+p,N=m-h,C=o*o*c+l,k=u.ma,L=u.mb,A=u.mc,O=u.me,M=u.mf,_=u.mg,D=u.mi,P=u.mj,H=u.mk;u.ma=k*y+L*E+A*T;u.mb=k*b+L*S+A*N;u.mc=k*w+L*x+A*C;u.me=O*y+M*E+_*T;u.mf=O*b+M*S+_*N;u.mg=O*w+M*x+_*C;u.mi=D*y+P*E+H*T;u.mj=D*b+P*S+H*N;u.mk=D*w+P*x+H*C;if(u.ma<r&&u.ma>-r)u.ma=0;if(u.mb<r&&u.mb>-r)u.mb=0;if(u.mc<r&&u.mc>-r)u.mc=0;if(u.me<r&&u.me>-r)u.me=0;if(u.mf<r&&u.mf>-r)u.mf=0;if(u.mg<r&&u.mg>-r)u.mg=0;if(u.mi<r&&u.mi>-r)u.mi=0;if(u.mj<r&&u.mj>-r)u.mj=0;if(u.mk<r&&u.mk>-r)u.mk=0;t.inv(u);u.updateRotation(u)},getpivotX:function(){return this._pivotX},pivotX:function(e){if(!isNaN(Number(e)))this._pivotX=Number(e);else this._pivotX=e;this.invs=true},getpivotY:function(){return this._pivotY},pivotY:function(e){if(!isNaN(Number(e)))this._pivotY=Number(e);else this._pivotY=e;this.invs=true},getpivotZ:function(){return this._pivotZ},pivotZ:function(e){if(!isNaN(Number(e)))this._pivotZ=Number(e);else this._pivotZ=e;this.invs=true},localRotateX:function(e){this.rotate(this.getXAxis(),e)},localRotateY:function(e){this.rotate(this.getYAxis(),e)},localRotateZ:function(e){this.rotate(this.getZAxis(),e)},updateRotation:function(e){var t=this,n=Math.asin(e.mj);t.ry=0;t.rx=-n;if(n<Math.PI/2){if(n>-Math.PI/2){t.rz=-Math.atan2(-e.mb,e.mf);t.ry=-Math.atan2(-e.mi,e.mk)}else{t.rz=Math.atan2(e.mb,e.ma)}}else{t.rz=-Math.atan2(e.mc,e.ma)}},initAxis:function(){var e=this,n=-e.rx,r=e.ry,i=-e.rz,s=Math.cos(n),o=Math.sin(n),u=Math.cos(r),a=Math.sin(r),f=Math.cos(i),l=Math.sin(i),c=t.e;e.ma=f*u-l*-o*a;e.mb=-l*s;e.mc=f*-a-l*-o*u;e.me=l*u+f*-o*a;e.mf=f*s;e.mg=l*-a+f*-o*u;e.mi=s*a;e.mj=o;e.mk=s*u;if(e.ma<c&&e.ma>-c)e.ma=0;if(e.mb<c&&e.mb>-c)e.mb=0;if(e.mc<c&&e.mc>-c)e.mc=0;if(e.me<c&&e.me>-c)e.me=0;if(e.mf<c&&e.mf>-c)e.mf=0;if(e.mg<c&&e.mg>-c)e.mg=0;if(e.mi<c&&e.mi>-c)e.mi=0;if(e.mj<c&&e.mj>-c)e.mj=0;if(e.mk<c&&e.mk>-c)e.mk=0;t.inv(this)},getXAxis:function(){return{x:this.ma,y:this.mb,z:this.mc}},getYAxis:function(){return{x:this.me,y:this.mf,z:this.mg}},getZAxis:function(){return{x:this.mi,y:this.mj,z:this.mk}},getscaleX:function(){return this._scaleX},scaleX:function(e){this._scaleX=e;t.inv(this)},getscaleY:function(){return this._scaleY},scaleY:function(e){this._scaleY=e;t.inv(this)},getscaleZ:function(){return this._scaleZ},scaleZ:function(e){this._scaleZ=e;t.inv(this)},reset:function(){var e=this;e.id();e._x=e._y=e._z=e.rx=e.ry=e.rz=0;e._scaleX=e._scaleY=e._scaleZ=1},getdoubleSided:function(){return this._ds},doubleSided:function(e){this._ds=e;t.css(this.div,"backfaceVisibility",this._ds==true?"visible":"hidden");if(!t.support&&t.degrade){t.inv(this)}},updateSize:function(){var e=this,n=e.div,r="",i,s;e.invs=false;if(n.hasAttribute("data-width")){i=Number(n.getAttribute("data-width"))}else{i=n.width>0?n.width:n.offsetWidth}if(n.hasAttribute("data-height")){s=Number(n.getAttribute("data-height"))}else{s=n.height>0?n.height:n.offsetHeight}e._width=i;e._height=s;var o=Math.floor(i*.5),u=Math.floor(s*.5);if(typeof e._pivotX=="number"){e.regX=e._pivotX-o;r=e._pivotX+"px "}else if(e._pivotX=="left"){e.regX=-o;r="0px "}else if(e._pivotX=="right"){e.regX=o;r=i+"px "}else{e.regX=0;r=o+"px "}if(typeof e._pivotY=="number"){e.regY=e._pivotY-u;r+=e._pivotY+"px "}else if(e._pivotY=="top"){e.regY=-u;r+="0px "}else if(e._pivotY=="bottom"){e.regY=u;r+=s+"px "}else{e.regY=0;r+=u+"px "}if(typeof e._pivotZ=="number"){if(t.pfx=="Moz"){e.regZ=e._pivotZ}else{e.regZ=0}r+=e._pivotZ+"px"}else{e.regZ=0;r+="0px"}n.style.left=-o+"px";n.style.top=-u+"px";if(t.support){t.css(n,"transformOrigin",r)}else{if(t.degrade){t.degrade.updateSizeSprite(this)}}},update:function(){if(t.support){var e=this;if(!t.ie){var n=t.r2d;e.div.style[t.ctr]="translate3d("+(e._x-e.regX)+"px,"+(e._y-e.regY)+"px,"+(e._z-e.regZ)+"px) rotateY("+e.ry*n+"deg) rotateX("+e.rx*n+"deg) rotateZ("+e.rz*n+"deg) scale3d("+e._scaleX+","+ -e._scaleY+","+ -e._scaleZ+")"}else{var r=e.view,i=r.ma,s=-r.me,o=-r.mi,u=r.mb,a=-r.mf,f=-r.mj,l=r.mc,c=-r.mg,h=-r.mk,p=-(r._x*r.ma+r._y*r.mb+r._z*r.mc),d=-(r._x*-r.me+r._y*-r.mf+r._z*-r.mg),v=-(r._x*-r.mi+r._y*-r.mj+r._z*-r.mk),m=(e.ma*i+e.mb*u+e.mc*l)*e._scaleX,g=(e.ma*s+e.mb*a+e.mc*c)*e._scaleX,y=(e.ma*o+e.mb*f+e.mc*h)*e._scaleX,b=(-e.me*i+ -e.mf*u+ -e.mg*l)*e._scaleY,w=(-e.me*s+ -e.mf*a+ -e.mg*c)*e._scaleY,E=(-e.me*o+ -e.mf*f+ -e.mg*h)*e._scaleY,S=(e.mi*i+e.mj*u+e.mk*l)*-e._scaleZ,x=(e.mi*s+e.mj*a+e.mk*c)*-e._scaleZ,T=(e.mi*o+e.mj*f+e.mk*h)*-e._scaleZ,N=e._x-e.regX,C=e._y+e.regY,k=e._z-e.regZ,L=N*i+C*u+k*l+p,A=N*s+C*a+k*c+d,O=N*o+C*f+k*h+v;e.zd=-O;e.div.style[t.ctr]="perspective("+e.view._perspective+"px) matrix3d("+m+","+g+","+y+",0,"+b+","+w+","+E+",0,"+S+","+x+","+T+",0,"+L+","+A+","+(O+e.view._perspective)+",1)"}}else{if(t.degrade){t.degrade.updateSprite(this)}}},setDiv:function(e){this.div=e;e.style.position="absolute";t.css(e,"transformStyle","preserve-3d")}};t.View3d.prototype=new t.Sprite3d;t.support=function(){var e,n,r=document.createElement("div"),i=["Webkit","Moz","O","ms"];for(e=0;e<i.length;e++){n=i[e];if(n+"Perspective"in r.style){t.pfx=n;t.pfxCss="-"+n.toLowerCase()+"-";t.ctr=n+"Transform";if(n=="ms"){t.ie=true}else if(n=="Webkit"){t.trEnd="webkitTransitionEnd";t.anEnd="webkitAnimationEnd"}return true}}return false}()})(jQuery)