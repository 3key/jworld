(function(e){if(e.fn.world){var t=e.fn.world.core;t.degradeHtml4={updateSprite:function(e){var n={},r={},i={},s={},o=e.view._width/2,u=e.view._height/2,a=e._width,f=e._height;t.stp.projectPoint(e.view,e,0,0,0,n,true);var l="block";if(n.culled){e.div.style.display="none";return}else{e.div.style.left=Math.floor(n.sx)+"px";e.div.style.top=Math.floor(n.sy)+"px"}if(typeof e.noDepthScale==="undefined"){t.stp.projectPoint(e.view,e,.01,-f/2,.01,r,true);t.stp.projectPoint(e.view,e,a/2,.01,.01,i,true);var c=i.sx-n.sx;var h=i.sy-n.sy;var p=Math.sqrt(c*c+h*h);var d=r.sx-n.sx;var v=r.sy-n.sy;var m=Math.sqrt(d*d+v*v);if(c>0){e.div.style.width=Math.floor(p*2)+"px";e.div.style.left=Math.floor(n.sx)-p+"px"}else{if(e._doubleSided==true){e.div.style.width=Math.floor(-p*2)+"px";e.div.style.left=Math.floor(n.sx)+p+"px"}else{l="none"}}if(v>0){e.div.style.height=Math.floor(m*2)+"px";e.div.style.top=Math.floor(n.sy)-m+"px"}else{if(e._doubleSided==true){e.div.style.height=Math.floor(-m*2)+"px";e.div.style.top=Math.floor(n.sy)+m+"px"}else{l="none"}}}e.div.style.display=l},updateSizeSprite:function(e){},updateSizeView:function(e){var n=987654;var r=.01;if(!e._ortho){var i=e._height/e._width;var s=Math.cos(e._fov/2)/Math.sin(e._fov/2);var o=i*s;var u=n/(n-r);t.stp.html4_a=o;t.stp.html4_f=s;t.stp.html4_k=u;t.stp.html4_o=-u*r}},updateView:function(e){var n=e.tgv;var r=t.stp.html4_cgv;r.a=n.a*t.stp.html4_a;r.b=n.e*t.stp.html4_f;r.c=n.i*t.stp.html4_k;r.e=n.b*t.stp.html4_a;r.f=n.f*t.stp.html4_f;r.g=n.j*t.stp.html4_k;r.i=n.c*t.stp.html4_a;r.j=n.g*t.stp.html4_f;r.k=n.k*t.stp.html4_k;var i=e._x;var s=e._y;var o=e._z;t.stp.html4_x=-(i*n.a+s*n.b+o*n.c)*t.stp.html4_a;t.stp.html4_y=-(i*n.e+s*n.f+o*n.g)*t.stp.html4_f;t.stp.html4_z=-(i*n.i+s*n.j+o*n.k)*t.stp.html4_k+t.stp.html4_o;for(var u=0;u<e.sprites.length;u++){e.sprites[u].update();t.cancelUpdate(e.sprites[u])}e.sprites.sort(t.sortFunc);for(u=0;u<e.sprites.length;u++){e.sprites[u].div.style.zIndex=e.startDepth+u}}};t.stp.projectPoint=function(e,n,r,i,s,o,u){if(n!=null){var a=n.tgv;var f=a.a*r+a.e*i+a.i*s+n._x;var l=a.b*r+a.f*i+a.j*s+n._y;var c=a.c*r+a.g*i+a.k*s+n._z;r=f;i=l;s=c}var h=t.stp.html4_cgv;o.wx=h.a*r+h.e*i+h.i*s+t.stp.html4_x;o.wy=h.b*r+h.f*i+h.j*s+t.stp.html4_y;o.wz=h.c*r+h.g*i+h.k*s+t.stp.html4_z+.01;var p=e._height/2;var d=e._width/2;if(!e._ortho){if(u){if(o.wz<.01||o.wy<-o.wz||o.wy>o.wz||o.wx<-o.wz||o.wx>o.wz){o.culled=true}}else{o.culled=false}if(o.wz>0){o.sy=-o.wy/o.wz*p;o.sx=o.wx/o.wz*d}else{o.sy=-o.wy*p;o.sx=o.wx*d}}};t.stp.html4_cgv=new t.Matrix3d;t.stp.html4_x=0;t.stp.html4_y=0;t.stp.html4_z=0;t.stp.html4_a=0;t.stp.html4_f=0;t.stp.html4_k=0;t.stp.html4_o=0;t.degrade=t.degradeHtml4}})(jQuery)